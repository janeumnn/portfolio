---
import config from '$/config';
import PageLayout from '$/layouts/page-layout.astro';
import { obfuscate } from '$/utils/obfuscator';

const { author, socials } = config;
---

<PageLayout>
  <Fragment slot="main">
    <div class="rounded-box bg-base-300 p-4">
      <div class="flex w-full flex-col items-center gap-8">
        <div class="flex w-full flex-col items-center gap-8 p-2 pb-0 text-center">
          <h1 class="text-2xl font-bold">Let's get in touch</h1>
          <p class="text-sm text-balance">
            Feel free to reach out! Whether you have a question, feedback, or a collaboration
            proposal, I'd love to hear from you.
          </p>
        </div>
        <form class="flex w-full max-w-lg flex-col gap-4">
          <div class="flex flex-col gap-4 @md/main:flex-row">
            <label class="input w-full">
              <span class="icon-[ri--user-line] w-5"></span>
              <input type="text" placeholder="Your Name" required />
            </label>
            <label class="validator input w-full">
              <span class="icon-[ri--mail-line] w-5"></span>
              <input type="email" placeholder="Your Email" required />
            </label>
          </div>
          <textarea
            name="message"
            placeholder="Message"
            class="textarea min-h-48 w-full textarea-md"
            required>
          </textarea>
          <button type="submit" class="btn mx-auto w-40 btn-primary">Send</button>
        </form>
        <div class="mt-4 flex w-full flex-col items-center gap-2 p-2 pt-0 text-center">
          {author.location && <span class="text-sm">Based in {author.location}</span>}
          <div class="mt-2 flex flex-wrap justify-center gap-3 @md/main:gap-4">
            {
              author.email && (
                <a
                  id="email-link"
                  role="button"
                  class="btn btn-circle btn-outline btn-sm"
                  href={`mailto:${obfuscate(author.email)}`}
                  data-email-href={`mailto:${obfuscate(author.email)}`}
                  aria-label="Send an email">
                  <span class="icon-[ri--mail-fill] h-full w-4" />
                </a>
              )
            }
            {
              socials.github && (
                <a
                  role="button"
                  class="btn btn-circle btn-outline btn-sm"
                  href={socials.github}
                  target="_blank"
                  rel="noopener noreferrer"
                  aria-label="Go to GitHub">
                  <span class="icon-[ri--github-fill] h-full w-4" />
                </a>
              )
            }
            {
              socials.linkedin && (
                <a
                  role="button"
                  class="btn btn-circle btn-outline btn-sm"
                  href={socials.linkedin}
                  target="_blank"
                  rel="noopener noreferrer"
                  aria-label="Go to LinkedIn">
                  <span class="icon-[ri--linkedin-fill] h-full w-4" />
                </a>
              )
            }
            {
              socials.instagram && (
                <a
                  role="button"
                  class="btn btn-circle btn-outline btn-sm"
                  href={socials.instagram}
                  target="_blank"
                  rel="noopener noreferrer"
                  aria-label="Go to Instagram">
                  <span class="icon-[ri--instagram-fill] h-full w-4" />
                </a>
              )
            }
          </div>
        </div>
      </div>
    </div>
  </Fragment>
</PageLayout>

<script>
  import { deobfuscate } from '$/utils/obfuscator';

  const emailLink = document.getElementById('email-link') as HTMLAnchorElement;
  if (emailLink) {
    const obfuscatedHref = emailLink.getAttribute('data-email-href');
    if (obfuscatedHref) {
      const obfuscatedEmail = obfuscatedHref.replace('mailto:', '');
      const deobfuscatedEmail = deobfuscate(obfuscatedEmail);
      emailLink.href = `mailto:${deobfuscatedEmail}`;
    }
  }
</script>
